<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>مدار الخبر | متجددة لحظة بلحظة</title>
  <meta name="description" content="مدار الخبر — صفحة أخبار عربية متجددة لحظة بلحظة.">
  <meta name="theme-color" content="#0ea5e9">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Tajawal',system-ui,Arial,sans-serif;background:#f8fafc;color:#0f172a;line-height:1.9}
    .article{background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    .article h3{font-size:1.25rem;font-weight:800;margin-bottom:6px}
    .article p{text-align:justify;font-size:1rem;margin-top:6px;white-space:pre-line}
    .clock{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>

<!-- HEADER -->
<header class="bg-white/90 backdrop-blur sticky top-0 z-50 border-b border-slate-100">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div style="width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#0ea5e9,#6366f1);box-shadow:0 6px 16px rgba(14,165,233,.35)"></div>
      <div>
        <div class="text-2xl font-extrabold bg-gradient-to-r from-sky-500 to-indigo-500 text-transparent bg-clip-text">مدار الخبر</div>
      </div>
    </div>
    <!-- ساعة حية صغيرة -->
    <div class="clock text-sm px-2 py-1 rounded-lg bg-slate-100 text-slate-700" id="liveClock">--:--:--</div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-5xl mx-auto px-4 py-6">
  <!-- شارة تنبيه بالتحديث التلقائي -->
  <div class="mb-4 text-[13px] text-sky-800 bg-sky-100 border border-sky-200 rounded-lg px-3 py-2">
    📡 يتم تحديث الأخبار تلقائيًا كل دقيقة
  </div>

  <h2 class="text-xl font-bold mb-4">آخر الأخبار</h2>

  <div id="newsList" class="space-y-6"></div>

  <div class="flex justify-center mt-6">
    <button id="loadMore" class="px-5 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
      تحميل المزيد
    </button>
  </div>
</main>

<!-- FOOTER -->
<footer class="text-center py-10 text-sm text-slate-500">
  © <span id="year"></span> مدار الخبر — جميع الحقوق محفوظة.
</footer>
<div class="text-center text-xs opacity-80 -mt-6 mb-8">
  برمجة و تطوير : فاضل الريس
</div>

<script>
// ===== إعدادات =====
const FEEDS = [
  // بحرينية
  "https://feeds.feedburner.com/alayam-news-list-all",
  "https://alwatannews.net/rssFeed/0",
  "https://bahrainmirror.com/rss.xml",
  // عامة
  "https://feeds.bbci.co.uk/arabic/rss.xml",
  "https://www.france24.com/ar/rss",
  "https://www.skynewsarabia.com/rss",
  "https://arabic.cnn.com/rss",
  "https://arabic.rt.com/rss/"
];
const PROXIES = [
  u => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(u)}`,
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`
];
// ✅ تحديث تلقائي كل دقيقة
const AUTO_REFRESH_MIN = 1;

const state={all:[],page:0,pageSize:10};
const $=s=>document.querySelector(s);

function stripHtml(h){const d=document.createElement("div");d.innerHTML=h;return d.textContent||"";}
function hasAr(t){return /[\u0600-\u06FF]/.test(t||"");}
function fmt(t){const d=new Date(t);if(isNaN(d))return"";return d.toLocaleString('ar-EG',{dateStyle:'medium',timeStyle:'short'});}

// ساعة حية
function startClock(){
  const el=$("#liveClock");
  function tick(){el.textContent=new Date().toLocaleTimeString('ar-BH',{hour12:false});}
  tick();setInterval(tick,1000);
}

async function fetchFeed(u){
  for(const p of PROXIES){
    try{
      const res=await fetch(p(u)); if(!res.ok) continue;
      if(p(u).includes("rss2json")){
        const js=await res.json(); if(!js.items) continue;
        return js.items.map(it=>({title:it.title,full:stripHtml(it.content||it.description||""),time:it.pubDate}));
      }
      const txt=await res.text();
      const doc=new DOMParser().parseFromString(txt,"text/xml");
      return [...doc.querySelectorAll("item,entry")].map(it=>({
        title:(it.querySelector("title")?.textContent||"").trim(),
        full:stripHtml((it.querySelector("content\\:encoded")?.textContent||it.querySelector("description")?.textContent||it.querySelector("summary")?.textContent||"").trim()),
        time:(it.querySelector("pubDate")?.textContent||it.querySelector("updated")?.textContent||"")
      }));
    }catch(e){continue;}
  }
  return [];
}

async function loadAll(){
  let all=[];
  for(const f of FEEDS){
    const items=await fetchFeed(f);
    all=[...all,...items.filter(i=>hasAr(i.title)||hasAr(i.full))];
  }
  // إزالة التكرار
  const seen=new Set(),uniq=[];
  for(const it of all){
    const k=(it.title||"")+"|"+(it.full||"").slice(0,100);
    if(seen.has(k)) continue;
    seen.add(k); uniq.push(it);
  }
  // ترتيب بالأحدث ثم الطول
  uniq.sort((a,b)=> (Date.parse(b.time)||0)-(Date.parse(a.time)||0) || ((b.full||"").length-(a.full||"").length) );
  state.all=uniq; state.page=0; render(true);
}

function articleHTML(a){
  return `<div class="article">
    <h3>${a.title||""}</h3>
    <div class="text-xs text-slate-500 mb-2">${a.time?fmt(a.time):""}</div>
    <p>${a.full||""}</p>
  </div>`;
}
function render(reset){
  if(reset) state.page=0;
  const end=(state.page+1)*state.pageSize;
  const list=state.all.slice(0,end);
  $("#newsList").innerHTML=list.map(articleHTML).join("");
  $("#loadMore").disabled=end>=state.all.length;
}

$("#loadMore").onclick=()=>{state.page++;render(false);}
$("#year").textContent=new Date().getFullYear();

// تشغيل
startClock();
loadAll();
setInterval(loadAll, AUTO_REFRESH_MIN*60*1000);
</script>
</body>
</html>
