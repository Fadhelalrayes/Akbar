<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± | Ù…ØªØ¬Ø¯Ø¯Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©</title>
  <meta name="description" content="Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± â€” ØµÙØ­Ø© Ø£Ø®Ø¨Ø§Ø± Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ¬Ø¯Ø¯Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©ØŒ ØªØ¹Ø±Ø¶ Ø§Ù„Ù†Øµ ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø±ÙˆØ§Ø¨Ø·.">
  <meta name="theme-color" content="#0ea5e9">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Tajawal',system-ui,Arial,sans-serif;background:#f8fafc;color:#0f172a;line-height:1.9}
    .article{background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    .article h3{font-size:1.25rem;font-weight:800;margin-bottom:6px}
    .article p{text-align:justify;font-size:1rem;margin-top:6px;white-space:pre-line}
    .clock{font-variant-numeric:tabular-nums}
    .chip{padding:.45rem .8rem;border-radius:999px;border:1px solid #e2e8f0;background:#fff;font-weight:600;font-size:.85rem}
    .chip.active{background:linear-gradient(180deg,#0ea5e9,#0284c7);color:#fff;border-color:transparent}
    .more-btn{display:inline-flex;align-items:center;gap:.4rem;font-size:.85rem;padding:.4rem .7rem;border-radius:10px;border:1px solid #c7d2fe;background:#eef2ff;color:#3730a3}
    .more-btn:hover{filter:brightness(0.98)}
    .more-btn svg{width:16px;height:16px}
    .dev-link{cursor:pointer;color:#0369a1;font-weight:600}
    .dev-link:hover{text-decoration:underline}
  </style>
</head>
<body>

<!-- HEADER -->
<header class="bg-white/90 backdrop-blur sticky top-0 z-50 border-b border-slate-100">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div style="width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#0ea5e9,#6366f1);box-shadow:0 6px 16px rgba(14,165,233,.35)"></div>
      <div>
        <div class="text-2xl font-extrabold bg-gradient-to-r from-sky-500 to-indigo-500 text-transparent bg-clip-text">Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø±</div>
      </div>
    </div>
    <!-- Ø³Ø§Ø¹Ø© Ø­ÙŠØ© ØµØºÙŠØ±Ø© -->
    <div class="clock text-sm px-2 py-1 rounded-lg bg-slate-100 text-slate-700" id="liveClock">--:--:--</div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-6xl mx-auto px-4 py-6">
  <!-- Ø´Ø§Ø±Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
  <div class="mb-4 text-[13px] text-sky-800 bg-sky-100 border border-sky-200 rounded-lg px-3 py-2">
    ğŸ“¡ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  </div>

  <!-- ÙÙ„Ø§ØªØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div id="filters" class="flex flex-wrap gap-2 mb-5"></div>

  <div id="newsList" class="grid gap-6 sm:grid-cols-1 lg:grid-cols-2"></div>

  <div class="flex justify-center mt-8">
    <button id="loadMore" class="px-5 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
      ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
    </button>
  </div>
</main>

<!-- FOOTER -->
<footer class="text-center py-10 text-sm text-slate-500">
  Â© <span id="year"></span> Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
</footer>
<div class="text-center text-xs opacity-80 -mt-6 mb-8">
  <span class="dev-link" onclick="openWhatsApp()">Ø¨Ø±Ù…Ø¬Ø© Ùˆ ØªØ·ÙˆÙŠØ± : ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</span>
</div>

<script>
// ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =====
// Ù…ØµØ§Ø¯Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠØ©
const FEEDS_BH = [
  "https://feeds.feedburner.com/alayam-news-list-all", // Ø§Ù„Ø£ÙŠØ§Ù…
  "https://alwatannews.net/rssFeed/0",                  // Ø§Ù„ÙˆØ·Ù†
  "https://bahrainmirror.com/rss.xml"                  // Ø¨Ø­Ø±ÙŠÙ† Ù…ÙŠØ±ÙˆØ±
];
// Ù…ØµØ§Ø¯Ø± Ø¹Ø±Ø¨ÙŠØ© Ø¹Ø§Ù…Ø© (Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ§ÙŠ Ù†ÙŠÙˆØ²)
const FEEDS_AR = [
  "https://www.aljazeera.net/xml/rss/all.xml", // Ø§Ù„Ø¬Ø²ÙŠØ±Ø©
  "https://www.alarabiya.net/.mrss/ar.xml",    // Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
  "https://feeds.bbci.co.uk/arabic/rss.xml",   // BBC Ø¹Ø±Ø¨ÙŠ
  "https://www.france24.com/ar/rss",           // France24 Ø¹Ø±Ø¨ÙŠ
  "https://arabic.cnn.com/rss",                // CNN Ø¹Ø±Ø¨ÙŠ
  "https://arabic.rt.com/rss/"                 // RT Ø¹Ø±Ø¨ÙŠ
];
const FEEDS = [...FEEDS_BH, ...FEEDS_AR];

// Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù„ØªØ¬Ø§ÙˆØ² CORS (Ù†Ø¬Ø±Ø¨Ù‡Ø§ Ø¨Ø§Ù„ØªØ³Ù„Ø³Ù„)
const PROXIES = [
  u => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(u)}`, // JSON
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`            // XML
];

// ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
const AUTO_REFRESH_MIN = 1;

// Ø£Ù‚Ø³Ø§Ù… ÙˆÙÙ„Ø§ØªØ±
const SECTIONS = ["Ø§Ù„ÙƒÙ„","Ø¹Ø§Ø¬Ù„","Ø³ÙŠØ§Ø³Ø©","Ø§Ù‚ØªØµØ§Ø¯","Ø±ÙŠØ§Ø¶Ø©","ØªÙ‚Ù†ÙŠØ©","ÙÙ† ÙˆØ«Ù‚Ø§ÙØ©","ØµØ­Ø©","Ø¹Ù„ÙˆÙ…","Ù…Ø­Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†"];
const state = { all: [], filtered: [], page: 0, pageSize: 10, section: "Ø§Ù„ÙƒÙ„" };

const $ = s => document.querySelector(s);

function stripHtml(h){const d=document.createElement("div");d.innerHTML=h;return (d.textContent||"").trim();}
function hasAr(t){return /[\u0600-\u06FF]/.test(t||"");}
function fmt(t){const d=new Date(t);if(isNaN(d))return"";return d.toLocaleString('ar-EG',{dateStyle:'medium',timeStyle:'short'});}

// ØªØµÙ†ÙŠÙ Ø¨Ø³ÙŠØ· Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
function classify(title="", body=""){
  const t = `${title} ${body}`;
  const rules = [
    ["Ø¹Ø§Ø¬Ù„", ["Ø¹Ø§Ø¬Ù„","ÙƒØ³Ø±"]],
    ["Ø³ÙŠØ§Ø³Ø©", ["Ø­ÙƒÙˆÙ…Ø©","Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª","Ø±Ø¦Ø§Ø³Ø©","Ø³ÙŠØ§Ø³Ø©","Ø¨Ø±Ù„Ù…Ø§Ù†","Ø­Ø²Ø¨","ÙˆØ²Ø§Ø±Ø©","Ù‚Ø§Ù†ÙˆÙ†"]],
    ["Ø§Ù‚ØªØµØ§Ø¯", ["Ø§Ù‚ØªØµØ§Ø¯","Ø¨ÙˆØ±ØµØ©","Ø³Ù‡Ù…","Ø¹Ù…Ù„Ø©","Ù†ÙØ·","Ø¨Ù†Ùƒ","Ø§Ø³ØªØ«Ù…Ø§Ø±","ØªØ¶Ø®Ù…","Ø¹Ø¬Ø²"]],
    ["Ø±ÙŠØ§Ø¶Ø©", ["Ø±ÙŠØ§Ø¶Ø©","Ù…Ø¨Ø§Ø±Ø§Ø©","Ù„Ø§Ø¹Ø¨","Ø¯ÙˆØ±ÙŠ","ÙƒØ£Ø³","Ù†Ø§Ø¯ÙŠ","Ù…Ø¯Ø±Ø¨","Ø£ÙˆÙ„Ù…Ø¨ÙŠØ§Ø¯"]],
    ["ØªÙ‚Ù†ÙŠØ©", ["ØªÙ‚Ù†ÙŠØ©","ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§","Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ","Ù‡Ø§ØªÙ","Ø¨Ø±Ù…Ø¬ÙŠØ§Øª","ÙƒÙ…Ø¨ÙŠÙˆØªØ±"]],
    ["ØµØ­Ø©",   ["ØµØ­Ø©","ÙˆØ¨Ø§Ø¡","Ù„Ù‚Ø§Ø­","Ø·Ø¨ÙŠØ¨","Ø³Ø±Ø·Ø§Ù†","Ø¯ÙˆØ§Ø¡","Ù…Ø³ØªØ´ÙÙ‰"]],
    ["ÙÙ† ÙˆØ«Ù‚Ø§ÙØ©", ["ÙÙ†","Ø³ÙŠÙ†Ù…Ø§","Ø¯Ø±Ø§Ù…Ø§","Ù…Ø³Ù„Ø³Ù„","Ø­ÙÙ„Ø©","Ù…ÙˆØ³ÙŠÙ‚Ù‰","Ø«Ù‚Ø§ÙØ©","Ù…Ø³Ø±Ø­","Ù†Ø¬ÙˆÙ…"]],
    ["Ø¹Ù„ÙˆÙ…", ["Ø§ÙƒØªØ´Ø§Ù","Ø¨Ø­Ø«","Ø¹Ù„Ù…","ÙØ¶Ø§Ø¡","Ù†Ø§Ø³Ø§","Ø¹Ù„Ù…Ø§Ø¡"]],
    ["Ù…Ø­Ù„ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†", ["Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†","Ø§Ù„Ù…Ù†Ø§Ù…Ø©","Ø§Ù„Ù…Ø­Ø±Ù‚","Ø³ÙŠÙ‡Ø§Øª","Ø§Ù„Ø±ÙØ§Ø¹","Ø³ØªØ±Ø©","ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠØ©","Ù…Ø¬Ù„Ø³ Ø§Ù„Ù†ÙˆØ§Ø¨ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠ","BNA","Ø§Ù„Ø£ÙŠØ§Ù…","Ø§Ù„ÙˆØ·Ù†"]]
  ];
  for(const [sec,keys] of rules){
    if(keys.some(k => t.includes(k))) return sec;
  }
  return "Ø§Ù„ÙƒÙ„";
}

// Ø³Ø§Ø¹Ø© Ø­ÙŠØ©
function startClock(){
  const el=$("#liveClock");
  function tick(){ el.textContent=new Date().toLocaleTimeString('ar-BH',{hour12:false}); }
  tick(); setInterval(tick,1000);
}

// ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ø³ÙÙ„ÙŠ
function openWhatsApp(){
  const link="https://api.whatsapp.com/send/?phone=97333375858&type=phone_number&app_absent=0";
  window.open(link,"_blank","noopener");
}

async function fetchFeed(u){
  for(const p of PROXIES){
    try{
      const res=await fetch(p(u), {cache:"no-store"}); if(!res.ok) continue;
      if(p(u).includes("rss2json")){
        const js=await res.json(); if(!js || !Array.isArray(js.items)) continue;
        return js.items.map(it=>({
          title:(it.title||"").trim(),
          full: stripHtml((it.content||it.description||"").trim()),
          time: it.pubDate || it.pubdate || ""
        }));
      }
      const txt=await res.text();
      const doc=new DOMParser().parseFromString(txt,"text/xml");
      return [...doc.querySelectorAll("item,entry")].map(it=>({
        title:(it.querySelector("title")?.textContent||"").trim(),
        full: stripHtml(
          (it.querySelector("content\\:encoded")?.textContent ||
           it.querySelector("description")?.textContent       ||
           it.querySelector("summary")?.textContent           || "").trim()
        ),
        time:(it.querySelector("pubDate")?.textContent||it.querySelector("updated")?.textContent||"")
      }));
    }catch(e){/* Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ */}
  }
  return [];
}

async function loadAll(){
  let all=[];
  for(const f of FEEDS){
    const items=await fetchFeed(f);
    all = all.concat(items.filter(i=>hasAr(i.title)||hasAr(i.full)));
  }
  // ØµÙ†Ù‘Ù ÙˆØ£Ø²Ù„ Ø§Ù„ØªÙƒØ±Ø§Ø±
  const seen=new Set(), uniq=[];
  for(const it of all){
    const sec = classify(it.title, it.full);
    const obj = {...it, section: sec};
    const key=(obj.title||"")+"|"+(obj.full||"").slice(0,130);
    if(seen.has(key)) continue;
    seen.add(key); uniq.push(obj);
  }
  // ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø£Ø­Ø¯Ø« Ø«Ù… Ø§Ù„Ø·ÙˆÙ„
  uniq.sort((a,b)=> (Date.parse(b.time)||0)-(Date.parse(a.time)||0) || ((b.full||"").length - (a.full||"").length));
  state.all=uniq;
  applyFilter(true);
}

// ÙÙ„Ø§ØªØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function renderFilters(){
  const wrap = $("#filters");
  wrap.innerHTML = SECTIONS.map(s => `<button class="chip ${s===state.section?'active':''}" data-sec="${s}">${s}</button>`).join("");
  wrap.querySelectorAll("button[data-sec]").forEach(btn=>{
    btn.onclick = () => { state.section=btn.dataset.sec; applyFilter(true); renderFilters(); };
  });
}

function applyFilter(reset=false){
  if(reset) state.page=0;
  if(state.section==="Ø§Ù„ÙƒÙ„") state.filtered = [...state.all];
  else state.filtered = state.all.filter(x => x.section===state.section);
  renderList();
}

// Ù‚ØµÙ‘ Ù†Øµ Ù„Ø¹Ø±Ø¶ Ù…Ù‚ØªØ·Ù + Â«Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯Â»
function excerpt(txt, limit=380){
  if(!txt) return "";
  return txt.length<=limit ? txt : txt.slice(0, limit);
}

// Ø¨Ø·Ø§Ù‚Ø© Ø®Ø¨Ø± Ù…Ø¹ Ø²Ø± Â«Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯Â»
function articleHTML(a, expanded=false){
  const id = btoa((a.title||"")+(a.time||"")).slice(0,16);
  const shown = expanded ? (a.full||"") : excerpt(a.full||"");
  const moreLabel = expanded ? "Ø¥Ø®ÙØ§Ø¡" : "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯";
  const icon = expanded
    ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 15l-6-6-6 6"/></svg>`
    : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 9l6 6 6-6"/></svg>`;
  return `
    <article class="article" data-id="${id}">
      <div class="text-xs text-slate-500 mb-1">${a.time?fmt(a.time):""} â€¢ <span class="rounded-full px-2 py-0.5 bg-slate-100">${a.section||"â€”"}</span></div>
      <h3>${a.title||""}</h3>
      <p class="content" data-full="${encodeURIComponent(a.full||"")}" data-expanded="${expanded?'1':'0'}">${shown}</p>
      ${(a.full && a.full.length>380) ? `
        <button class="more-btn mt-3" data-act="toggle" aria-label="${moreLabel}">
          ${icon}<span>${moreLabel}</span>
        </button>` : ``}
    </article>`;
}

function renderList(){
  const end = (state.page+1)*state.pageSize;
  const list = state.filtered.slice(0, end);
  $("#newsList").innerHTML = list.map(a => articleHTML(a,false)).join("");
  $("#loadMore").disabled = end >= state.filtered.length;
  $("#loadMore").textContent = end >= state.filtered.length ? "Ù„Ø§ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø®Ø¨Ø§Ø±" : "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯";
}

// ØªÙÙˆÙŠØ¶ Ø²Ø± Â«Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯Â»
document.addEventListener("click",(e)=>{
  const btn=e.target.closest("button.more-btn"); if(!btn) return;
  const art=btn.closest("article"); const p=art.querySelector(".content");
  const expanded=p.getAttribute("data-expanded")==="1";
  const full=decodeURIComponent(p.getAttribute("data-full")||"");
  if(expanded){
    p.textContent=excerpt(full);
    p.setAttribute("data-expanded","0");
    btn.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 9l6 6 6-6"/></svg><span>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯</span>`;
  }else{
    p.textContent=full;
    p.setAttribute("data-expanded","1");
    btn.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 15l-6-6-6 6"/></svg><span>Ø¥Ø®ÙØ§Ø¡</span>`;
  }
});

function renderMore(){ state.page++; renderList(); }

/* ØªØ´ØºÙŠÙ„ */
$("#year").textContent = new Date().getFullYear();
$("#loadMore").onclick = renderMore;
startClock();
renderFilters();
loadAll();
setInterval(loadAll, AUTO_REFRESH_MIN*60*1000);
</script>
</body>
</html>
