<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± | Ù…ØªØ¬Ø¯Ø¯Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©</title>
  <meta name="description" content="Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± â€” ØµÙØ­Ø© Ø£Ø®Ø¨Ø§Ø± Ø¹Ø±Ø¨ÙŠØ© Ù…ØªØ¬Ø¯Ø¯Ø© Ù„Ø­Ø¸Ø© Ø¨Ù„Ø­Ø¸Ø©.">
  <meta name="theme-color" content="#0ea5e9">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Tajawal',system-ui,Arial,sans-serif;background:#f8fafc;color:#0f172a;line-height:1.9}
    .article{background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    .article h3{font-size:1.25rem;font-weight:800;margin-bottom:6px}
    .article p{text-align:justify;font-size:1rem;margin-top:6px;white-space:pre-line}
    .clock{font-variant-numeric:tabular-nums}
    .more-btn{display:inline-flex;align-items:center;gap:.4rem;font-size:.85rem;padding:.4rem .7rem;border-radius:10px;border:1px solid #c7d2fe;background:#eef2ff;color:#3730a3}
    .more-btn:hover{filter:brightness(0.97)}
    .more-btn svg{width:16px;height:16px}
    .dev-link{cursor:pointer;color:#0369a1;font-weight:600}
    .dev-link:hover{text-decoration:underline}
    .btn{padding:.55rem .9rem;border-radius:12px;border:1px solid #e2e8f0;background:#fff;font-weight:600}
    .btn-brand{background:#0ea5e9;color:#fff;border-color:transparent}
  </style>
</head>
<body>

<!-- HEADER -->
<header class="bg-white/90 backdrop-blur sticky top-0 z-50 border-b border-slate-100">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div style="width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#0ea5e9,#6366f1);box-shadow:0 6px 16px rgba(14,165,233,.35)"></div>
      <div>
        <div class="text-2xl font-extrabold bg-gradient-to-r from-sky-500 to-indigo-500 text-transparent bg-clip-text">Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø±</div>
      </div>
    </div>
    <!-- Ø³Ø§Ø¹Ø© Ø­ÙŠØ© + ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù† -->
    <div class="flex items-center gap-2">
      <div class="clock text-sm px-2 py-1 rounded-lg bg-slate-100 text-slate-700" id="liveClock">--:--:--</div>
      <button id="refreshNow" class="btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-5xl mx-auto px-4 py-6">
  <div class="mb-4 text-[13px] text-sky-800 bg-sky-100 border border-sky-200 rounded-lg px-3 py-2">
    ğŸ“¡ ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  </div>

  <!-- Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª -->
  <div id="emptyState" class="hidden rounded-xl border border-slate-200 bg-white p-5 text-slate-600">
    Ù„Ù… ÙŠØªÙ… Ø¬Ù„Ø¨ Ø£ÙŠ Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¢Ù†. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ù…Ø¤Ù‚Ù‘Øª Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø±.
    <div class="mt-3">
      <button id="tryAgain" class="btn btn-brand">Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§</button>
    </div>
  </div>

  <div id="newsList" class="space-y-6"></div>

  <div class="flex justify-center mt-8">
    <button id="loadMore" class="px-5 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700 disabled:opacity-50 disabled:cursor-not-allowed">
      ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯
    </button>
  </div>
</main>

<!-- FOOTER -->
<footer class="text-center py-10 text-sm text-slate-500">
  Â© <span id="year"></span> Ù…Ø¯Ø§Ø± Ø§Ù„Ø®Ø¨Ø± â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
</footer>
<div class="text-center text-xs opacity-80 -mt-6 mb-8">
  <span class="dev-link" onclick="openWhatsApp()">Ø¨Ø±Ù…Ø¬Ø© Ùˆ ØªØ·ÙˆÙŠØ± : ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</span>
</div>

<script>
// ===== Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© ÙˆØªØ¹Ù…Ù„ Ø¹Ø§Ø¯Ø© Ù…Ø¹ Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù†ØµÙ‘ÙŠØ© =====
const FEEDS = [
  "https://feeds.bbci.co.uk/arabic/rss.xml",
  "https://www.france24.com/ar/rss",
  "https://arabic.cnn.com/rss",
  "https://arabic.rt.com/rss/"
];

// ===== Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ù†ØµÙ‘ÙŠØ© (Ø¨Ø¯ÙˆÙ† rss2json) Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹ + Ù…Ù‡Ù„Ø© =====
const PROXIES = [
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
  u => `https://corsproxy.io/?${encodeURIComponent(u)}`,
  // r.jina.ai ÙŠØ¹Ù…Ù„ ÙƒÙ‚Ø§Ø±Ø¦ Ù…Ø­ØªÙˆÙ‰Ø› Ù†Ù„ÙÙ‘ Ø§Ù„Ù€ https Ø¹Ø¨Ø± r.jina.ai Ø«Ø§Ù†Ù Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‚ÙŠÙˆØ¯
  u => `https://r.jina.ai/http://r.jina.ai/${encodeURIComponent(u)}`
];

const FETCH_TIMEOUT_MS = 9000; // Ù…Ù‡Ù„Ø© Ù„ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø©
const AUTO_REFRESH_MIN = 1;    // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

const state={all:[],page:0,pageSize:10};
const $=s=>document.querySelector(s);

function stripHtml(h){const d=document.createElement("div");d.innerHTML=h;return (d.textContent||"").trim();}
function hasAr(t){return /[\u0600-\u06FF]/.test(t||"");}
function fmt(t){const d=new Date(t);if(isNaN(d))return"";return d.toLocaleString('ar-EG',{dateStyle:'medium',timeStyle:'short'});}

// Ø³Ø§Ø¹Ø© Ø­ÙŠØ©
function startClock(){
  const el=$("#liveClock");
  function tick(){el.textContent=new Date().toLocaleTimeString('ar-BH',{hour12:false});}
  tick();setInterval(tick,1000);
}

// ÙˆØ§ØªØ³Ø§Ø¨
function openWhatsApp(){
  const link="https://api.whatsapp.com/send/?phone=97333375858&type=phone_number&app_absent=0";
  window.open(link,"_blank","noopener");
}

// fetch Ù…Ø¹ Ù…Ù‡Ù„Ø©
async function fetchWithTimeout(url, timeoutMs=FETCH_TIMEOUT_MS){
  const ctrl = new AbortController();
  const t = setTimeout(()=>ctrl.abort(), timeoutMs);
  try{
    const res = await fetch(url, {signal: ctrl.signal, cache: "no-store"});
    clearTimeout(t);
    if(!res.ok) throw new Error("bad status");
    return await res.text();
  }catch(e){
    clearTimeout(t);
    throw e;
  }
}

// Ø¬Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠØ§Øª Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹
async function fetchViaProxies(url){
  for(const p of PROXIES){
    try{
      const txt = await fetchWithTimeout(p(url));
      return txt;
    }catch(e){
      // Ø¬Ø±Ù‘Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
    }
  }
  throw new Error("all proxies failed");
}

function parseRSS(xmlText){
  const doc = new DOMParser().parseFromString(xmlText, "text/xml");
  const items = Array.from(doc.querySelectorAll("item,entry")).map(el=>{
    const title=(el.querySelector("title")?.textContent||"").trim();
    const full = stripHtml(
      (el.querySelector("content\\:encoded")?.textContent ||
       el.querySelector("description")?.textContent       ||
       el.querySelector("summary")?.textContent           || "").trim()
    );
    const pub  =(el.querySelector("pubDate")?.textContent||el.querySelector("updated")?.textContent||"").trim();
    return {title, full, time: pub};
  }).filter(i => hasAr(i.title)||hasAr(i.full));
  return items;
}

async function loadAll(){
  $("#emptyState").classList.add("hidden");
  let all=[];
  // Ù†Ø¬Ù„Ø¨ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹ Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø¶ØºØ· ÙˆÙ…Ù†Ø¹ Ø§Ù„Ø­Ø¸Ø±
  for(const f of FEEDS){
    try{
      const xml = await fetchViaProxies(f);
      const items = parseRSS(xml);
      all = all.concat(items);
    }catch(e){
      console.warn("ÙØ´Ù„ Ø¬Ù„Ø¨:", f);
    }
  }
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
  const seen=new Set(), uniq=[];
  for(const it of all){
    const key=(it.title||"")+"|"+(it.full||"").slice(0,120);
    if(seen.has(key)) continue;
    seen.add(key); uniq.push(it);
  }
  // ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø£Ø­Ø¯Ø« Ø«Ù… Ø§Ù„Ø·ÙˆÙ„
  uniq.sort((a,b)=> (Date.parse(b.time)||0)-(Date.parse(a.time)||0) || ((b.full||"").length-(a.full||"").length) );

  state.all=uniq; state.page=0;
  render(true);

  // Ø¥Ù† Ù„Ù… ØªØµÙ„ Ø£ÙŠ Ø£Ø®Ø¨Ø§Ø±ØŒ Ø£Ø¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
  if(!state.all.length){
    $("#emptyState").classList.remove("hidden");
  }
}

// Ù…Ù‚ØªØ·Ù + Ø²Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯
function excerpt(txt, limit=350){return (txt||"").length<=limit?txt:txt.slice(0,limit);}
function articleHTML(a,expanded=false){
  const full=a.full||"";
  const shown=expanded?full:excerpt(full);
  const moreLabel=expanded?"Ø¥Ø®ÙØ§Ø¡":"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯";
  const icon=expanded
    ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 15l-6-6-6 6"/></svg>`
    : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 9l6 6 6-6"/></svg>`;
  return `<article class="article">
    <h3>${a.title||""}</h3>
    <div class="text-xs text-slate-500 mb-2">${a.time?fmt(a.time):""}</div>
    <p class="content" data-full="${encodeURIComponent(full)}" data-expanded="${expanded?'1':'0'}">${shown}</p>
    ${(full.length>350)?`<button class="more-btn mt-3" data-act="toggle">${icon}<span>${moreLabel}</span></button>`:""}
  </article>`;
}

function render(reset){
  if(reset) state.page=0;
  const end=(state.page+1)*state.pageSize;
  const list=state.all.slice(0,end);
  $("#newsList").innerHTML=list.map(a=>articleHTML(a,false)).join("");
  $("#loadMore").disabled=end>=state.all.length;
}

document.addEventListener("click",e=>{
  // Ø²Ø± "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯"
  const btn=e.target.closest("button.more-btn");if(btn){
    const art=btn.closest("article");const p=art.querySelector(".content");
    const expanded=p.getAttribute("data-expanded")==="1";
    const full=decodeURIComponent(p.getAttribute("data-full")||"");
    if(expanded){
      p.textContent=excerpt(full);
      p.setAttribute("data-expanded","0");
      btn.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 9l6 6 6-6"/></svg><span>Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯</span>`;
    }else{
      p.textContent=full;
      p.setAttribute("data-expanded","1");
      btn.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 15l-6-6-6 6"/></svg><span>Ø¥Ø®ÙØ§Ø¡</span>`;
    }
  }
});

// Ø£Ø²Ø±Ø§Ø±
$("#loadMore").onclick=()=>{state.page++;render(false);};
$("#refreshNow").onclick=()=>loadAll();
$("#tryAgain").onclick=()=>loadAll();

$("#year").textContent=new Date().getFullYear();

// ØªØ´ØºÙŠÙ„
startClock();
loadAll();
setInterval(loadAll, AUTO_REFRESH_MIN*60*1000);
</script>
</body>
</html>
