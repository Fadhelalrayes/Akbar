<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>مدار الخبر | الأخبار الكاملة</title>
  <meta name="description" content="مدار الخبر — آخر الأخبار العربية كاملة بدون روابط.">
  <meta name="theme-color" content="#0ea5e9">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f8fafc;line-height:1.9}
    .article{background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    .article h3{font-size:1.3rem;font-weight:700;margin-bottom:8px}
    .article p{text-align:justify;font-size:1rem;margin-top:6px}
    .ticker{overflow:hidden;white-space:nowrap;background:#0ea5e9;color:#fff}
    .ticker__track{display:inline-block;padding-left:100%;animation:marquee 25s linear infinite}
    @keyframes marquee{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
  </style>
</head>
<body class="text-slate-800">

<header class="shadow bg-white sticky top-0 z-50">
  <div class="max-w-5xl mx-auto flex items-center justify-between p-4">
    <h1 class="text-2xl font-extrabold text-sky-600">مدار الخبر</h1>
    <div class="flex items-center gap-2">
      <input id="search" placeholder="ابحث..." class="px-3 py-2 rounded-xl border w-40 md:w-72">
      <button id="modeBtn" class="px-3 py-2 border rounded-xl">☀︎/🌙</button>
    </div>
  </div>
  <div class="ticker text-sm"><div class="ticker__track" id="tickerTrack">مدار الخبر — آخر الأخبار العربية كاملة بلا روابط</div></div>
</header>

<main class="max-w-5xl mx-auto px-4 py-6">
  <div id="status" class="text-sm text-slate-500 mb-4"></div>
  <div id="newsList" class="space-y-6"></div>
  <div class="flex justify-center mt-6">
    <button id="loadMore" class="px-5 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700">تحميل المزيد</button>
  </div>
</main>

<footer class="text-center py-10 text-sm text-slate-500">
  © <span id="year"></span> مدار الخبر — جميع الحقوق محفوظة.
</footer>
<div class="text-center text-xs opacity-80 -mt-6 mb-8">
  برمجة و تطوير : فاضل الريس
</div>

<!-- زر واتساب -->
<a href="https://api.whatsapp.com/send/?phone=97333375858&type=phone_number&app_absent=0"
   target="_blank" rel="noopener" aria-label="WhatsApp"
   class="fixed bottom-5 right-5 w-14 h-14 rounded-full shadow-lg flex items-center justify-center"
   style="background:#25D366">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="26" height="26" fill="#fff">
    <path d="M19.11 17.06c-.3-.17-1.76-.94-2.04-1.05-.27-.1-.47-.16-.66.16-.2.33-.77 1.05-.95 1.27-.17.2-.35.22-.65.08-.3-.16-1.27-.47-2.42-1.5-.9-.8-1.5-1.78-1.67-2.08-.18-.3-.02-.46.13-.62.13-.13.3-.35.44-.53.15-.18.2-.3.3-.5.1-.2.05-.38-.02-.54-.08-.17-.66-1.58-.9-2.18-.24-.58-.49-.5-.66-.5l-.56-.01c-.2 0-.53.08-.8.38-.27.3-1.03 1-1.03 2.43 0 1.44 1.06 2.84 1.21 3.04.16.22 2.1 3.2 5.1 4.48.71.31 1.26.5 1.69.64.71.23 1.36.2 1.87.12.57-.09 1.76-.72 2.01-1.42.25-.7.25-1.3.17-1.42-.07-.12-.26-.2-.56-.36z"/>
    <path d="M26.72 5.28A13.44 13.44 0 0 0 16 .56C7.32.56.28 7.6.28 16.28c0 2.8.73 5.54 2.11 7.96L.56 31.44l7.36-1.77a15.4 15.4 0 0 0 8.08 2.3h.01c8.68 0 15.72-7.04 15.72-15.72 0-4.2-1.63-8.16-4.72-11.27zM16 28.94h-.01a12.9 12.9 0 0 1-6.58-1.8l-.47-.28-4.37 1.05 1.04-4.26-.3-.44a12.84 12.84 0 0 1-2-6.93C3.32 9.02 9.02 3.32 16 3.32c3.4 0 6.6 1.32 9 3.72 2.4 2.4 3.72 5.6 3.72 9 0 7-5.7 12.9-12.72 12.9z"/>
  </svg>
</a>

<script>
// مصادر RSS (عامة + بحرينية)
const FEEDS = [
  "https://feeds.bbci.co.uk/arabic/rss.xml",
  "https://www.france24.com/ar/rss",
  "https://www.skynewsarabia.com/rss",
  "https://arabic.cnn.com/rss",
  "https://arabic.rt.com/rss/",
  "https://feeds.feedburner.com/alayam-news-list-all",
  "https://alwatannews.net/rssFeed/0",
  "https://bahrainmirror.com/rss.xml"
];

// بروكسيات
const PROXIES = [
  u => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(u)}`,
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
  u => `https://r.jina.ai/http://r.jina.ai/http://r.jina.ai/${encodeURIComponent(u)}`
];

const state={all:[],page:0,pageSize:10};
const $=s=>document.querySelector(s);

function stripHtml(h){const d=document.createElement("div");d.innerHTML=h;return d.textContent||"";}
function hasAr(t){return /[\u0600-\u06FF]/.test(t||"");}

async function fetchFeed(u){
  for(const p of PROXIES){
    try{
      const url=p(u);
      const res=await fetch(url);
      if(!res.ok) continue;
      const txt=await res.text();
      // rss2json يرجع JSON
      if(url.includes("rss2json")){
        const js=JSON.parse(txt);
        return js.items.map(it=>({title:it.title,full:stripHtml(it.content||it.description||""),time:it.pubDate}));
      }
      // غير ذلك: XML
      const doc=new DOMParser().parseFromString(txt,"text/xml");
      return [...doc.querySelectorAll("item")].map(it=>({
        title:(it.querySelector("title")?.textContent||"").trim(),
        full:stripHtml((it.querySelector("description")?.textContent||"").trim()),
        time:it.querySelector("pubDate")?.textContent||""
      }));
    }catch(e){continue;}
  }
  return [];
}

async function loadAll(){
  let all=[];
  for(const f of FEEDS){
    const items=await fetchFeed(f);
    all=[...all,...items.filter(i=>hasAr(i.title)||hasAr(i.full))];
  }
  state.all=all;
  $("#status").textContent=`تم تحميل ${all.length} خبر`;
  render(true);
}

function render(reset){
  if(reset) state.page=0;
  const end=(state.page+1)*state.pageSize;
  const slice=state.all.slice(0,end);
  $("#newsList").innerHTML=slice.map(i=>`
    <div class="article">
      <h3>${i.title}</h3>
      <div class="text-xs text-slate-500 mb-2">${i.time||""}</div>
      <p>${i.full}</p>
    </div>`).join("");
  $("#tickerTrack").textContent=slice.slice(0,10).map(x=>x.title).join(" • ");
  $("#loadMore").disabled=end>=state.all.length;
}

$("#loadMore").onclick=()=>{state.page++;render(false);}
$("#modeBtn").onclick=()=>document.documentElement.classList.toggle("dark");
$("#year").textContent=new Date().getFullYear();
$("#search").addEventListener("keyup",e=>{
  if(e.key==="Enter"){
    const q=$("#search").value.trim();
    const arr=state.all.filter(x=>(x.title||"").includes(q)||(x.full||"").includes(q));
    $("#newsList").innerHTML=arr.map(i=>`<div class="article"><h3>${i.title}</h3><p>${i.full}</p></div>`).join("")||"لا نتائج";
  }
});

loadAll();
</script>
</body>
</html>
